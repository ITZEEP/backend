<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.scoula.domain.home.mapper.HomeIdentityMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="homeIdentityResultMap" type="org.scoula.domain.home.vo.HomeIdentityVO">
        <id property="homeIdentityId" column="home_identity_id"/>
        <result property="homeId" column="home_id"/>
        <result property="userId" column="user_id"/>
        <result property="name" column="name"/>
        <result property="birthDate" column="birth_date"/>
        <result property="identityVerifiedAt" column="identity_verified_at"/>
    </resultMap>

    <!-- 본인 인증 정보 저장 -->
    <insert id="insertHomeIdentity" parameterType="org.scoula.domain.home.vo.HomeIdentityVO">
        INSERT INTO home_identity (
            home_id,
            user_id,
            name,
            birth_date,
            identity_verified_at
        ) VALUES (
            #{vo.homeId},
            #{vo.userId},
            #{vo.name},
            #{vo.birthDate},
            NOW()
        )
    </insert>

    <!-- 본인 인증 정보 조회 -->
    <select id="selectHomeIdentity" resultMap="homeIdentityResultMap">
        SELECT
            home_identity_id,
            home_id,
            user_id,
            name,
            birth_date,
            identity_verified_at
        FROM home_identity
        WHERE home_id = #{homeId}
          AND user_id = #{userId}
    </select>

    <!-- 본인 인증 정보 업데이트 -->
    <update id="updateHomeIdentity" parameterType="org.scoula.domain.home.vo.HomeIdentityVO">
        UPDATE home_identity
        SET
            name = #{vo.name},
            birth_date = #{vo.birthDate},
            identity_verified_at = NOW()
        WHERE home_id = #{vo.homeId}
          AND user_id = #{vo.userId}
    </update>

    <!-- 매물 ID로 본인 인증 정보 조회 -->
    <select id="selectHomeIdentityByHomeId" resultMap="homeIdentityResultMap">
        SELECT
            home_identity_id,
            home_id,
            user_id,
            name,
            birth_date,
            identity_verified_at
        FROM home_identity
        WHERE home_id = #{homeId}
        ORDER BY identity_verified_at DESC
        LIMIT 1
    </select>

</mapper>